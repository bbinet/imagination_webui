<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<style type="text/css">
		body { font-family:Arial; font-size:12pt; padding:20px; width:100%; margin:20px auto; }
		ul { margin:0px; padding:0px; margin-left:20px; }
		#photos { width:100%; list-style-type:none; margin:0px; }
		#photos li { float:left; padding:5px; width:320px; height:340px; text-align:center;}
		.placeHolder div { width:320px; height:340px; background-color:white !important; border:dashed 1px gray !important; }
        .hidden { display: none; }
	</style>
</head>
<body>
    <ul id="photos">
        <li>
            <div>
                <span data-type="editable" data-for=".editable-area">Edit me!</span>
                <textarea class="editable-area hidden"></textarea>
            </div>
        </li>
    </ul>

	<div style="clear:both;"></div>

	<!-- save sort order here which can be retrieved on server on postback -->
	<input name="photosOrder" />

	<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
	<script type="text/javascript" src="jquery.dragsort.js"></script>
	<script type="text/javascript" src="jquery.editable-1.0.1.js"></script>
	<script type="text/javascript">
        $.getJSON('../', function(data) {
            var items = [];
            $.each(data, function(idx, val) {
                items.push(
                    '<li>' +
                    '<img src="' + val.url + '">' +
                    '<div data-type="editable" data-for="#' + idx + '">' + val.text + '</div>' +
                    '<textarea class="hidden" id="' + idx + '"></textarea>' +
                    '</li>');
            });
            $('ul#photos').html(items.join(''));
            $('ul#photos').editables({
                beforeEdit: function(field){
                    field.val(this.text());
                },
                beforeFreeze: function(display){
                    display.text(this.val());
                }
            });
        });
		function savePhotosOrder() {
            var data = $("#photos li textarea").map(function() {
                return $(this).attr("id")
                return $(this).children().html();
            }).get();
			$("input[name=photosOrder]").val(data.join("|"));
		};

        $("#photos").dragsort({
            dragSelector: "img",
            dragBetween: true,
            dragEnd: savePhotosOrder,
            placeHolderTemplate: "<li class='placeHolder'><div></div></li>"
        });

	</script>
</body>
</html>
